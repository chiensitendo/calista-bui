<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Universe</title>
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            outline: none;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #333;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 360px;
            height: 640px;
            background-color: #70c5ce;
            overflow: hidden;
            border: 4px solid #fff;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            cursor: pointer;
        }

        /* --- CHARACTER PHYSICS CONTAINER --- */
        #character {
            position: absolute;
            width: 40px;
            height: 30px;
            z-index: 10;
            left: 60px;
            /* No transition for instant response */
        }

        /* ================= SKINS ================= */
        
        /* 1. BIRD */
        .skin-bird {
            background-color: #ffeb3b;
            border: 2px solid #000;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            width: 100%; height: 100%; position: relative;
        }
        .skin-bird::before { /* Wing */
            content: ''; position: absolute; width: 14px; height: 10px;
            background: #fff; border: 2px solid #000; border-radius: 50%;
            top: 8px; left: 4px;
        }
        .skin-bird::after { /* Eye */
            content: ''; position: absolute; width: 8px; height: 8px;
            background: #000; border-radius: 50%; top: 4px; right: 8px;
            border: 2px solid white;
        }
        .beak {
            position: absolute; width: 12px; height: 10px;
            background: #ff5722; border: 2px solid #000;
            right: -8px; top: 10px; border-radius: 50%;
        }

        /* 2. PLANE */
        .skin-plane {
            background-color: #e74c3c;
            border: 2px solid #000;
            border-radius: 40% 50% 50% 40%;
            width: 100%; height: 80%; margin-top: 10%; position: relative;
        }
        .skin-plane::before { /* Window */
            content: ''; position: absolute; width: 10px; height: 10px;
            background: #81d4fa; border: 2px solid #000; border-radius: 3px;
            top: 2px; right: 8px;
        }
        .skin-plane::after { /* Tail */
            content: ''; position: absolute; border-left: 10px solid #c0392b;
            border-top: 5px solid transparent; border-bottom: 5px solid transparent;
            left: -8px; top: 0px; transform: rotate(180deg);
        }
        .propeller {
            position: absolute; width: 18px; height: 4px;
            background: #bdc3c7; border: 1px solid #000;
            right: -6px; top: 8px; animation: spin 0.1s linear infinite;
        }

        /* 3. DOG */
        .skin-dog {
            background-color: #795548;
            border: 2px solid #000; border-radius: 12px;
            width: 100%; height: 100%; position: relative;
        }
        .skin-dog::before { /* Ear */
            content: ''; position: absolute; width: 12px; height: 18px;
            background: #4e342e; border: 2px solid #000;
            border-radius: 0 0 10px 10px; top: 4px; left: -4px;
        }
        .skin-dog::after { /* Eye */
            content: ''; position: absolute; width: 6px; height: 6px;
            background: #000; border-radius: 50%; top: 8px; right: 10px;
            box-shadow: 2px 2px 0 rgba(255,255,255,0.3);
        }
        .nose {
            position: absolute; width: 10px; height: 8px;
            background: #000; border-radius: 50%; right: -4px; top: 14px;
        }

        /* 4. UFO */
        .skin-ufo {
            background: #95a5a6; /* Silver */
            border: 2px solid #000; border-radius: 50%;
            width: 100%; height: 80%; margin-top: 10%; position: relative;
            box-shadow: inset 0 -4px 0 rgba(0,0,0,0.2);
        }
        .skin-ufo::before { /* Dome */
            content: ''; position: absolute; width: 20px; height: 12px;
            background: #81d4fa; border: 2px solid #000;
            border-radius: 50% 50% 0 0; top: -10px; left: 8px;
        }
        .lights {
            position: absolute; width: 4px; height: 4px; background: #ffff00;
            border-radius: 50%; top: 50%; left: 50%;
            box-shadow: -12px 0 0 #ff0000, 12px 0 0 #00ff00;
            transform: translate(-50%, 0);
        }

        /* 5. GHOST */
        .skin-ghost {
            background: #fff;
            border: 2px solid #000; border-bottom: none;
            border-radius: 20px 20px 0 0;
            width: 80%; height: 100%; margin-left: 10%; position: relative;
        }
        .skin-ghost::before { /* Eyes */
            content: ''; position: absolute; width: 6px; height: 6px;
            background: #000; border-radius: 50%; top: 8px; left: 6px;
            box-shadow: 12px 0 0 #000;
        }
        .skin-ghost::after { /* Wavy Bottom using CSS Gradient trick */
            content: ''; position: absolute; bottom: -4px; left: -2px;
            width: 115%; height: 6px;
            background: radial-gradient(circle, #fff 3px, transparent 4px);
            background-size: 8px 8px;
        }

        /* ================= WORLD ================= */
        .pipe {
            position: absolute; width: 64px;
            background-color: #2ecc71; border: 3px solid #000; z-index: 5;
        }
        .pipe.top { border-bottom: 6px solid #000; border-radius: 0 0 4px 4px; }
        .pipe.bottom { border-top: 6px solid #000; border-radius: 4px 4px 0 0; }

        #ground {
            position: absolute; bottom: 0; width: 100%; height: 120px;
            background-color: #ded895; border-top: 4px solid #000; z-index: 20;
        }
        #ground-pattern {
            width: 200%; height: 100%;
            background-image: repeating-linear-gradient(-45deg, #d0c874 0, #d0c874 10px, #ded895 10px, #ded895 20px);
            position: absolute; bottom: 0; left: 0;
        }
        #score-display {
            position: absolute; top: 50px; width: 100%; text-align: center;
            font-size: 70px; font-weight: 900; color: white;
            -webkit-text-stroke: 3px #000; z-index: 30; pointer-events: none;
            text-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 40; display: flex; flex-direction: column;
            justify-content: center; align-items: center; background: rgba(0,0,0,0.3);
        }

        /* ================= UI MENU ================= */
        #start-card {
            background: #e67e22; padding: 20px 20px; width: 280px;
            border-radius: 10px; border: 4px solid #fff;
            box-shadow: 0 6px 0 #d35400; text-align: center;
            animation: bounce 1s infinite alternate;
        }
        #start-text { font-size: 24px; color: white; margin-bottom: 10px; }
        
        #selected-name {
            font-size: 18px; color: #fff; background: rgba(0,0,0,0.2);
            padding: 5px; border-radius: 5px; margin-bottom: 15px;
            font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
            border: 2px dashed rgba(255,255,255,0.5);
        }

        .avatar-container {
            display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .avatar-btn {
            width: 45px; height: 45px; border-radius: 8px;
            border: 3px solid rgba(0,0,0,0.2); background: rgba(255,255,255,0.2);
            cursor: pointer; display: flex; justify-content: center; align-items: center;
            transition: transform 0.1s;
        }
        .avatar-btn:hover { transform: scale(1.1); background: rgba(255,255,255,0.4); }
        .avatar-btn.selected {
            border-color: #fff; background: rgba(255,255,255,0.6);
            transform: scale(1.1); box-shadow: 0 0 10px #fff;
        }

        .mini-icon { width: 30px; height: 22px; pointer-events: none; zoom: 0.8; }

        #game-over-box {
            display: none; flex-direction: column; align-items: center;
            background: #ded895; border: 4px solid #000; padding: 20px;
            border-radius: 10px; pointer-events: auto; box-shadow: 10px 10px 0 rgba(0,0,0,0.4);
        }
        #restart-btn {
            margin-top: 15px; padding: 15px 40px; font-size: 20px;
            background: #2ecc71; color: white; border: 3px solid #000;
            cursor: pointer; font-weight: bold; font-family: inherit;
            border-radius: 5px; box-shadow: 0 4px 0 #27ae60;
        }
        #restart-btn:active { transform: translateY(4px); box-shadow: none; }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }
        @keyframes spin { 0% { transform: rotateX(0deg); } 100% { transform: rotateX(360deg); } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="character"></div>
    <div id="score-display">0</div>
    <div id="ground"><div id="ground-pattern"></div></div>

    <div id="ui-layer">
        <div id="start-card">
            <div id="start-text">
                <strong>FLAPPY WORLD</strong><br>
                <span style="font-size: 12px;">Press SPACE to Start</span>
            </div>
            
            <div id="selected-name">FLAPPY BIRD</div>

            <div class="avatar-container">
                <div class="avatar-btn selected" onclick="selectAvatar('bird', this)">
                    <div class="mini-icon skin-bird"></div>
                </div>
                <div class="avatar-btn" onclick="selectAvatar('plane', this)">
                    <div class="mini-icon skin-plane"></div>
                </div>
                <div class="avatar-btn" onclick="selectAvatar('dog', this)">
                    <div class="mini-icon skin-dog"></div>
                </div>
                <div class="avatar-btn" onclick="selectAvatar('ufo', this)">
                    <div class="mini-icon skin-ufo"></div>
                </div>
                <div class="avatar-btn" onclick="selectAvatar('ghost', this)">
                    <div class="mini-icon skin-ghost"></div>
                </div>
            </div>
        </div>

        <div id="game-over-box">
            <h1 style="margin:0; font-size:35px; color:#e74c3c; -webkit-text-stroke: 1.5px #000;">GAME OVER</h1>
            <h2 id="final-score" style="margin:10px 0;">Score: 0</h2>
            <button id="restart-btn">Try Again</button>
        </div>
    </div>
</div>

<script>
    // --- CONFIG ---
    const GAME_WIDTH = 360;
    const GAME_HEIGHT = 640;
    const GROUND_HEIGHT = 120;
    const BIRD_X = 60; 
    const CHAR_WIDTH = 40;
    const CHAR_HEIGHT = 30;
    const HITBOX_PAD_X = 6; 
    const HITBOX_PAD_Y = 6;
    const GRAVITY = 0.15;        
    const JUMP_STRENGTH = -3.6;  
    const PIPE_SPEED = 2.2;     
    const PIPE_SPAWN_RATE = 110; 
    const PIPE_GAP = 200;       

    // --- STATE ---
    let gameState = 'START'; 
    let charY = 300;
    let velocity = 0;
    let rotation = 0;
    let score = 0;
    let frames = 0;
    let pipes = [];
    let currentCharType = 'bird'; 
    
    // --- ELEMENTS ---
    const charEl = document.getElementById('character');
    const containerEl = document.getElementById('game-container');
    const uiLayer = document.getElementById('ui-layer');
    const startCard = document.getElementById('start-card');
    const nameDisplay = document.getElementById('selected-name');
    const gameOverBox = document.getElementById('game-over-box');
    const finalScoreEl = document.getElementById('final-score');
    const scoreDisplay = document.getElementById('score-display');
    const groundPattern = document.getElementById('ground-pattern');
    const restartBtn = document.getElementById('restart-btn');

    // --- NAMES DICTIONARY ---
    const charNames = {
        bird: "FLAPPY BIRD",
        plane: "AERO PLANE",
        dog: "GOOD DOGGO",
        ufo: "ALIEN UFO",
        ghost: "SPOOKY GHOST"
    };

    // --- SELECTOR LOGIC ---
    window.selectAvatar = function(type, btnElement) {
        if(window.event) window.event.stopPropagation();
        
        currentCharType = type;
        
        // 1. Update Skin
        renderCharacterSkin();
        
        // 2. Update Name Text
        nameDisplay.innerText = charNames[type];

        // 3. Update Button Highlight
        document.querySelectorAll('.avatar-btn').forEach(btn => btn.classList.remove('selected'));
        btnElement.classList.add('selected');
    }

    function renderCharacterSkin() {
        charEl.innerHTML = '';
        const skinDiv = document.createElement('div');
        
        // Switch Logic for CSS Injection
        switch(currentCharType) {
            case 'bird':
                skinDiv.className = 'skin-bird';
                skinDiv.innerHTML = '<div class="beak"></div>';
                break;
            case 'plane':
                skinDiv.className = 'skin-plane';
                skinDiv.innerHTML = '<div class="propeller"></div>';
                break;
            case 'dog':
                skinDiv.className = 'skin-dog';
                skinDiv.innerHTML = '<div class="nose"></div>';
                break;
            case 'ufo':
                skinDiv.className = 'skin-ufo';
                skinDiv.innerHTML = '<div class="lights"></div>';
                break;
            case 'ghost':
                skinDiv.className = 'skin-ghost';
                break;
        }
        charEl.appendChild(skinDiv);
    }

    // Init
    renderCharacterSkin();

    // --- GAME ENGINE ---
    function handleInput(e) {
        const isSpace = e.type === 'keydown' && e.code === 'Space';
        const isClick = e.type === 'mousedown' && e.button === 0;

        if (isSpace || isClick) {
            if(e.target.closest('.avatar-container')) return;
            if(e.cancelable) e.preventDefault(); 
            
            if (gameState === 'GAMEOVER') return; 

            if (gameState === 'START') {
                startGame();
            } else if (gameState === 'PLAYING') {
                jump();
            }
        }
    }

    function handleRestart(e) {
        e.stopPropagation(); 
        resetGame();
        restartBtn.blur(); 
    }

    window.addEventListener('keydown', handleInput);
    containerEl.addEventListener('mousedown', handleInput);
    restartBtn.addEventListener('click', handleRestart);
    restartBtn.addEventListener('keydown', (e) => {
        if(e.code === 'Space') {
            e.preventDefault(); e.stopPropagation();
            resetGame(); restartBtn.blur();
        }
    });

    function loop() {
        if (gameState === 'PLAYING') {
            updatePhysics();
            updatePipes();
            checkCollisions();
            render();
            frames++;
        } else if (gameState === 'START') {
            charY = 300 + Math.sin(Date.now() / 300) * 8;
            charEl.style.top = charY + 'px';
            charEl.style.transform = `rotate(0deg)`;
            groundPattern.style.transform = `translateX(-${(Date.now() / 10) % 20}px)`;
        }
        requestAnimationFrame(loop);
    }

    function startGame() {
        gameState = 'PLAYING';
        startCard.style.display = 'none';
        velocity = JUMP_STRENGTH; 
    }

    function jump() {
        if (charY > -20) velocity = JUMP_STRENGTH;
    }

    function updatePhysics() {
        velocity += GRAVITY;
        charY += velocity;

        if (velocity < 0) rotation = -25;
        else {
            if (velocity < 3.0) rotation = -25;
            else {
                rotation += 4; 
                if (rotation > 90) rotation = 90;
            }
        }
        groundPattern.style.transform = `translateX(-${(frames * PIPE_SPEED) % 20}px)`;
    }

    function updatePipes() {
        if (frames % PIPE_SPAWN_RATE === 0) spawnPipe();
        pipes.forEach(pipe => {
            pipe.x -= PIPE_SPEED;
            if (!pipe.passed && pipe.x + 64 < BIRD_X) {
                score++;
                scoreDisplay.innerText = score;
                pipe.passed = true;
            }
        });
        if (pipes.length > 0 && pipes[0].x < -80) {
            pipes[0].topEl.remove(); pipes[0].bottomEl.remove(); pipes.shift();
        }
    }

    function spawnPipe() {
        const minHeight = 40;
        const maxPipeSpace = GAME_HEIGHT - GROUND_HEIGHT - PIPE_GAP - minHeight * 2;
        const randomY = Math.floor(Math.random() * maxPipeSpace) + minHeight;
        const topHeight = randomY;
        const bottomHeight = GAME_HEIGHT - GROUND_HEIGHT - PIPE_GAP - topHeight;
        const pipeX = GAME_WIDTH;

        const topEl = document.createElement('div');
        topEl.className = 'pipe top';
        topEl.style.height = topHeight + 'px';
        topEl.style.left = pipeX + 'px';
        topEl.style.top = '0';

        const bottomEl = document.createElement('div');
        bottomEl.className = 'pipe bottom';
        bottomEl.style.height = bottomHeight + 'px';
        bottomEl.style.left = pipeX + 'px';
        bottomEl.style.bottom = GROUND_HEIGHT + 'px';

        containerEl.appendChild(topEl);
        containerEl.appendChild(bottomEl);

        pipes.push({
            x: pipeX, topHeight: topHeight, bottomY: GAME_HEIGHT - GROUND_HEIGHT - bottomHeight,
            topEl: topEl, bottomEl: bottomEl, passed: false
        });
    }

    function render() {
        charEl.style.top = charY + 'px';
        charEl.style.transform = `rotate(${rotation}deg)`;
        pipes.forEach(pipe => {
            pipe.topEl.style.left = pipe.x + 'px';
            pipe.bottomEl.style.left = pipe.x + 'px';
        });
    }

    function checkCollisions() {
        if (charY + CHAR_HEIGHT >= GAME_HEIGHT - GROUND_HEIGHT) { endGame(); return; }
        const bx = BIRD_X + HITBOX_PAD_X;
        const by = charY + HITBOX_PAD_Y;
        const bw = CHAR_WIDTH - (HITBOX_PAD_X * 2);
        const bh = CHAR_HEIGHT - (HITBOX_PAD_Y * 2);

        pipes.forEach(pipe => {
            const px = pipe.x; const pw = 64; 
            if (bx + bw > px && bx < px + pw) {
                if (by < pipe.topHeight || by + bh > pipe.bottomY) endGame();
            }
        });
    }

    function endGame() {
        gameState = 'GAMEOVER';
        uiLayer.style.display = 'flex';
        gameOverBox.style.display = 'flex';
        finalScoreEl.innerText = "Score: " + score;
    }

    function resetGame() {
        pipes.forEach(p => { p.topEl.remove(); p.bottomEl.remove(); });
        pipes = [];
        charY = 300; velocity = 0; rotation = 0; score = 0; frames = 0;
        scoreDisplay.innerText = '0';
        gameOverBox.style.display = 'none';
        uiLayer.style.display = 'flex';
        startCard.style.display = 'block'; 
        renderCharacterSkin();
        gameState = 'START';
    }

    loop();
</script>

</body>
</html>